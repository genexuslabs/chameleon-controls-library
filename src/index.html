<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>Chameleon</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="./showcase/assets/icons/favicon.ico"
    />

    <script type="module" src="/build/chameleon.esm.js"></script>
    <script nomodule src="/build/chameleon.js"></script>

    <link href="showcase/base.css" rel="stylesheet" rel="preload" as="style" />
    <link href="showcase/index.css" rel="stylesheet" />
    <!-- <link
      href="https://unpkg.com/@genexus/unanimo@latest/dist/css/unanimo.css"
      rel="stylesheet"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    /> -->

    <style>
      /* Avoid FOUC (Flash Of Unstyled Content) */
      html:not(.hydrated) {
        visibility: hidden;
      }
    </style>
  </head>
  <body class="unanimo">
    <ch-layout-splitter>
      <header slot="header" class="header">
        <div class="header-start">
          <a
            id="chameleon-home"
            class="home heading-2"
            href="#"
            aria-label="Home"
            >Chameleon</a
          >
          <span id="chameleon-version" class="text-body-2"></span>
        </div>

        <div class="header-end">
          <ch-segmented-control-render
            id="segmented-control-rtl"
          ></ch-segmented-control-render>
          <ch-segmented-control-render
            id="segmented-control-theme"
          ></ch-segmented-control-render>

          <a
            href="https://github.com/genexuslabs/chameleon-controls-library"
            aria-label="Chameleon's GitHub"
            class="icon-background github-logo"
            target="_blank"
            title="Chameleon's GitHub"
          ></a>
        </div>
      </header>

      <aside slot="aside">
        <input
          type="search"
          class="form-input form-input-search sidebar__search-input"
          aria-label="Search"
          placeholder="Search"
        />

        <ch-tree-view-render
          class="tree-view-primary"
          filter-type="caption"
        ></ch-tree-view-render>
      </aside>

      <main slot="main">
        <div class="main-page text-body-2" hidden>
          <p class="heading-1">Chameleon</p>
          <h1 class="heading-4">
            A library of white-label, highly-customizable and reusable web
            components.
          </h1>

          <ul class="chameleon-features text-body-1">
            <li class="card icon-mask card__framework">
              Works with all frameworks
            </li>
            <li class="card icon-mask">üé® Fully customizable with CSS</li>
            <li class="card icon-mask">üè∑Ô∏è White-label components</li>
            <li class="card icon-mask card__accessibility">
              Built with accessibility in mind
            </li>
            <li class="card icon-mask">üöÄ Blazing fast performance</li>
            <li class="card icon-mask card__rtl">Full RTL support</li>
            <li class="card icon-mask">üòÉ Open source</li>
          </ul>

          <div class="sections">
            <section>
              <h2 id="quick-start" class="heading-2">
                Quick start

                <a href="#quick-start" aria-label='Direct link to "Quick Start"'
                  >#</a
                >
              </h2>
            </section>

            <section>
              <h2 id="goals-and-objectives" class="heading-2">
                Goals And Objectives

                <a
                  href="#goals-and-objectives"
                  aria-label='Direct link to "Goals And Objectives"'
                  >#</a
                >
              </h2>
            </section>

            <section>
              <h2 id="browser-support" class="heading-2">
                Browser support

                <a
                  href="#browser-support"
                  aria-label='Direct link to "Browser support"'
                  >#</a
                >
              </h2>

              <ul>
                <li>Chrome >= 114</li>
                <li>Edge >= 114</li>
                <li>Safari >= 17</li>
                <li>Firefox >= 125</li>
                <li>Opera >= 100</li>
              </ul>

              See
              <a
                class="text-link"
                href="https://caniuse.com/?search=popover"
                target="_blank"
                >Caniuse</a
              >
              for more information.
            </section>

            <section>
              <h2 id="license" class="heading-2">
                License

                <a href="#license" aria-label='Direct link to "License"'>#</a>
              </h2>
            </section>
          </div>
        </div>

        <ch-showcase></ch-showcase>
      </main>
    </ch-layout-splitter>

    <script type="module">
      import { treeViewComponents } from "./showcase/models/components.js";
      import {
        getTheme,
        setThemeInBrowser,
        storeTheme
      } from "./showcase/models/theme-manager.js";
      import {
        getLanguageDirection,
        storeLanguageDirection,
        setLanguageDirectionInBrowser
      } from "./showcase/models/language-manager.js";

      // Get the latest version
      fetch(
        `https://registry.npmjs.org/@genexus/chameleon-controls-library/latest`
      )
        .then(response => response.json())
        .then(data => {
          const chameleonVersion = document.getElementById("chameleon-version");
          chameleonVersion.textContent = data.version;
        });

      window.addEventListener("appload", () => {
        const layoutSplitterRef = document.querySelector("ch-layout-splitter");
        const treeViewRef = document.querySelector("ch-tree-view-render");
        const searchInputRef = document.querySelector(".form-input-search");
        const mainPage = document.querySelector(".main-page");
        const showcase = document.querySelector("ch-showcase");
        const home = document.querySelector(".home");
        const toggleThemeRef = document.getElementById(
          "segmented-control-theme"
        );
        const toggleRtlRef = document.getElementById("segmented-control-rtl");
        const chameleonHome = document.getElementById("chameleon-home");

        // Initialize themes
        toggleThemeRef.items = [
          {
            id: "dark",
            caption: "Dark"
          },
          {
            id: "light",
            caption: "Light"
          }
        ];

        // Initialize language directions
        toggleRtlRef.items = [
          {
            id: "ltr",
            caption: "LTR"
          },
          {
            id: "rtl",
            caption: "RTL"
          }
        ];

        toggleThemeRef.selectedId = getTheme();
        toggleRtlRef.selectedId = getLanguageDirection();

        const setMainPage = () => {
          mainPage.hidden = false;
          showcase.hidden = true;
          showcase.componentName = undefined;
          showcase.pageSrc = undefined;
        };

        const setPage = () => {
          if (window.location.hash && window.location.hash !== "#") {
            const componentName = window.location.hash.replace("#", "");
            const treeItemInformation = treeViewComponents.find(
              treeItem => treeItem.id === componentName
            );

            // If the hash is a valid page
            if (treeItemInformation) {
              showcase.componentName = componentName;
              showcase.pageSrc = `showcase/pages/${componentName}.html`;
              showcase.pageName = treeItemInformation.caption;
              showcase.status = treeItemInformation.metadata;

              mainPage.hidden = true;
              showcase.hidden = false;

              // Mark the new selected item in the Tree View
              treeViewRef.updateItemsProperties([componentName], {
                selected: true
              });
              return;
            }
          }

          // Go to Main page
          setMainPage();
        };

        // Initialize sample
        setPage();

        // WA to reset the page when clicking in the logo
        chameleonHome.addEventListener("click", () => {
          mainPage.hidden = false;
          showcase.hidden = true;
          showcase.componentName = undefined;
          showcase.pageSrc = undefined;
        });

        // Add event lister for the theme changes
        toggleThemeRef.addEventListener("selectedItemChange", () => {
          const newTheme = getTheme() === "light" ? "dark" : "light";

          storeTheme(newTheme);
          setThemeInBrowser(newTheme);
          showcase.theme = newTheme;
        });

        // Add event lister for the language direction changes
        toggleRtlRef.addEventListener("selectedItemChange", () => {
          const newLanguageDirection =
            getLanguageDirection() === "rtl" ? "ltr" : "rtl";

          storeLanguageDirection(newLanguageDirection);
          setLanguageDirectionInBrowser(newLanguageDirection);
        });

        const layoutSplitterModel = {
          id: "root",
          direction: "rows",
          items: [
            { id: "header", size: "48px", dragBar: { hidden: true } },
            {
              id: "content",
              direction: "columns",
              size: "1fr",
              items: [
                {
                  id: "aside",
                  size: "220px",
                  minSize: "200px",
                  dragBar: {
                    hidden: false,
                    size: 1
                  }
                },
                {
                  id: "main",
                  size: "1fr",
                  minSize: "500px"
                }
              ]
            }
          ]
        };

        layoutSplitterRef.model = layoutSplitterModel;
        treeViewRef.model = treeViewComponents;

        searchInputRef.addEventListener("input", () => {
          treeViewRef.filter = searchInputRef.value;
        });

        // When the selected item of the Tree View changes, the main page must be updated
        treeViewRef.addEventListener("selectedItemsChange", () => {
          if (event.detail?.length > 0) {
            const componentName = event.detail[0].item.id;

            // This is a WA until we have the ch-navigation-list component
            window.location.hash = `#${componentName}`;
          }
        });

        window.addEventListener("hashchange", setPage);
      });
    </script>
  </body>
</html>
