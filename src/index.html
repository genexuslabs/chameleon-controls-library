<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>Chameleon</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="./showcase/assets/icons/favicon.ico"
    />

    <script type="module" src="/build/chameleon.esm.js"></script>
    <script nomodule src="/build/chameleon.js"></script>

    <link href="showcase/base.css" rel="stylesheet" />
    <link href="showcase/index.css" rel="stylesheet" />
    <!-- <link
      href="https://unpkg.com/@genexus/unanimo@latest/dist/css/unanimo.css"
      rel="stylesheet"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    /> -->

    <style>
      /* Avoid FOUC (Flash Of Unstyled Content) */
      html:not(.hydrated) {
        visibility: hidden;
      }
    </style>
  </head>
  <body class="unanimo">
    <ch-layout-splitter>
      <header slot="header" class="header">
        <div class="header-start">
          <a
            id="chameleon-home"
            class="home heading-2"
            href="#"
            aria-label="Home"
            >Chameleon</a
          >
          <span id="chameleon-version" class="text-body-2"></span>
        </div>

        <div class="header-end">
          <ch-segmented-control-render></ch-segmented-control-render>

          <a
            href="https://github.com/genexuslabs/chameleon-controls-library"
            aria-label="Chameleon's GitHub"
            class="icon-background github-logo"
            target="_blank"
            title="Chameleon's GitHub"
          ></a>
        </div>
      </header>

      <aside slot="aside">
        <input
          type="search"
          class="form-input form-input-search"
          aria-label="Search"
          placeholder="Search"
        />

        <ch-tree-view-render
          css-class="tree-view-navigation"
          tree-view-item-css-class="tree-view-item-navigation"
          filter-type="caption"
        ></ch-tree-view-render>
      </aside>

      <main slot="main">
        <div class="main-page text-body-2" hidden>
          <p class="heading-1">Chameleon</p>
          <h1 class="heading-4">
            A library of white-label, highly-customizable and reusable web
            components.
          </h1>

          <ul class="chameleon-features">
            <li class="card text-body-1">üß© Works with all frameworks</li>
            <li class="card text-body-1">üé® Fully customizable with CSS</li>
            <li class="card text-body-1">üè∑Ô∏è White-label components</li>
            <li class="card text-body-1">
              ‚ôøÔ∏è Built with accessibility in mind
            </li>
            <li class="card text-body-1">üöÄ Blazing fast performance</li>
            <li class="card text-body-1 card__rtl">Full RTL support</li>
            <li class="card text-body-1">üòÉ Open source</li>
          </ul>

          <div class="sections">
            <section>
              <h2 id="quick-start" class="heading-2">
                Quick start

                <a href="#quick-start" aria-label='Direct link to "Quick Start"'
                  >#</a
                >
              </h2>
            </section>

            <section>
              <h2 id="goals-and-objectives" class="heading-2">
                Goals And Objectives

                <a
                  href="#goals-and-objectives"
                  aria-label='Direct link to "Goals And Objectives"'
                  >#</a
                >
              </h2>
            </section>

            <section>
              <h2 id="browser-support" class="heading-2">
                Browser support

                <a
                  href="#browser-support"
                  aria-label='Direct link to "Browser support"'
                  >#</a
                >
              </h2>
            </section>

            <section>
              <h2 id="license" class="heading-2">
                License

                <a href="#license" aria-label='Direct link to "License"'>#</a>
              </h2>
            </section>
          </div>
        </div>

        <ch-showcase></ch-showcase>
      </main>
    </ch-layout-splitter>

    <script type="module">
      import { treeViewComponents } from "./showcase/models/components.js";
      import {
        getTheme,
        setThemeInBrowser,
        storeTheme
      } from "./showcase/models/theme-manager.js";

      // Get the latest version
      fetch(
        `https://registry.npmjs.org/@genexus/chameleon-controls-library/latest`
      )
        .then(response => response.json())
        .then(data => {
          const chameleonVersion = document.getElementById("chameleon-version");
          chameleonVersion.textContent = data.version;
        });

      window.addEventListener("appload", () => {
        const layoutSplitterRef = document.querySelector("ch-layout-splitter");
        const treeViewRef = document.querySelector("ch-tree-view-render");
        const searchInputRef = document.querySelector(".form-input-search");
        const mainPage = document.querySelector(".main-page");
        const showcase = document.querySelector("ch-showcase");
        const home = document.querySelector(".home");
        const toggleThemeRef = document.querySelector(
          "ch-segmented-control-render"
        );
        const chameleonHome = document.getElementById("chameleon-home");

        toggleThemeRef.items = [
          {
            id: "dark",
            caption: "Dark"
          },
          {
            id: "light",
            caption: "Light"
          }
        ];

        toggleThemeRef.selectedId = getTheme();

        const setPage = (componentName, pageCaption) => {
          showcase.componentName = componentName;
          showcase.pageSrc = `showcase/pages/${componentName}.html`;
          showcase.pageName = pageCaption;

          mainPage.hidden = true;
          showcase.hidden = false;
        };

        // Initialize sample
        if (window.location.hash && window.location.hash !== "#") {
          const componentName = window.location.hash.replace("#", "");
          const treeItemInformation = treeViewComponents.find(
            treeItem => treeItem.id === componentName
          );

          if (treeItemInformation) {
            setPage(componentName, treeItemInformation.caption);
          }
          // Go to Main page
          else {
            mainPage.hidden = false;
          }
        }
        // Go to Main page
        else {
          mainPage.hidden = false;
        }

        // WA to reset the page when clicking in the logo
        chameleonHome.addEventListener("click", () => {
          mainPage.hidden = false;
          showcase.hidden = true;
          showcase.componentName = undefined;
          showcase.pageSrc = undefined;
        });

        // Add event lister for the theme changes
        toggleThemeRef.addEventListener("selectedItemChange", () => {
          const newTheme = getTheme() === "light" ? "dark" : "light";

          storeTheme(newTheme);
          setThemeInBrowser(newTheme);
          showcase.theme = newTheme;
        });

        const layoutSplitterModel = {
          id: "root",
          direction: "rows",
          items: [
            { id: "header", size: "48px", dragBar: { hidden: true } },
            {
              id: "content",
              direction: "columns",
              size: "1fr",
              items: [
                {
                  id: "aside",
                  size: "200px",
                  dragBar: {
                    hidden: false,
                    size: 1
                  }
                },
                {
                  id: "main",
                  size: "1fr"
                }
              ]
            }
          ]
        };

        layoutSplitterRef.layout = layoutSplitterModel;
        treeViewRef.treeModel = treeViewComponents;

        searchInputRef.addEventListener("input", () => {
          treeViewRef.filter = searchInputRef.value;
        });

        // When the selected item of the Tree View changes, the iframe must be visible
        treeViewRef.addEventListener("selectedItemsChange", () => {
          if (event.detail?.length > 0) {
            const componentName = event.detail[0].item.id;
            const pageCaption = event.detail[0].item.caption;
            setPage(componentName, pageCaption);

            // This is a WA until we have the ch-navigation-list component
            window.location.hash = `#${componentName}`;
          }
        });
      });
    </script>
  </body>
</html>
